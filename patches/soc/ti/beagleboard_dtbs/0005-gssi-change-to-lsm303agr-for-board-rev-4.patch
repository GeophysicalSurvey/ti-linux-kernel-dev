From d92c386b86b26962984878acbeb436d9c06bf119 Mon Sep 17 00:00:00 2001
From: Jeremy Stashluk <stashlukj@geophysical.com>
Date: Thu, 20 Aug 2020 15:04:57 -0400
Subject: [PATCH] gssi: change to lsm303agr for board rev 4

---
 arch/arm/boot/dts/am57xx-beagle-x15-gssi.dts  |   2 +-
 ...serial.dtsi => gssi-27-009-r2-serial.dtsi} |   0
 arch/arm/boot/dts/gssi-27-009-r4-serial.dtsi  | 104 ++++++++++++++++++
 3 files changed, 105 insertions(+), 1 deletion(-)
 rename arch/arm/boot/dts/{gssi-27-009-serial.dtsi => gssi-27-009-r2-serial.dtsi} (100%)
 create mode 100644 arch/arm/boot/dts/gssi-27-009-r4-serial.dtsi

diff --git a/arch/arm/boot/dts/am57xx-beagle-x15-gssi.dts b/arch/arm/boot/dts/am57xx-beagle-x15-gssi.dts
index 1d0d0dd6d957..8fd941b43283 100644
--- a/arch/arm/boot/dts/am57xx-beagle-x15-gssi.dts
+++ b/arch/arm/boot/dts/am57xx-beagle-x15-gssi.dts
@@ -4,7 +4,7 @@
 #include "gssi-27-009-rts-cyclone.dtsi"
 #include "gssi-27-009-rts-hv.dtsi"
 #include "gssi-27-009-rts-pru.dtsi"
-#include "gssi-27-009-serial.dtsi"
+#include "gssi-27-009-r4-serial.dtsi"
 #include "gssi-27-009-wl1837.dtsi"
 
 / {
diff --git a/arch/arm/boot/dts/gssi-27-009-serial.dtsi b/arch/arm/boot/dts/gssi-27-009-r2-serial.dtsi
similarity index 100%
rename from arch/arm/boot/dts/gssi-27-009-serial.dtsi
rename to arch/arm/boot/dts/gssi-27-009-r2-serial.dtsi
diff --git a/arch/arm/boot/dts/gssi-27-009-r4-serial.dtsi b/arch/arm/boot/dts/gssi-27-009-r4-serial.dtsi
new file mode 100644
index 000000000000..b363481d937d
--- /dev/null
+++ b/arch/arm/boot/dts/gssi-27-009-r4-serial.dtsi
@@ -0,0 +1,104 @@
+&dra7_pmx_core {
+	battery_pins: pinmux_battery_pins {
+		pinctrl-single,pins = <
+			DRA7XX_CORE_IOPAD(0x36b0, PIN_INPUT_PULLUP    | MUX_MODE10) /* J14 mcasp1_fsr   i2c4_scl */
+			DRA7XX_CORE_IOPAD(0x36ac, PIN_INPUT_PULLUP    | MUX_MODE10) /* B14 mcasp1_aclkr i2c4_sda */
+		>;
+	};
+
+	lsm303_pins: pinmux_lsm303_pins {
+		pinctrl-single,pins = <
+			DRA7XX_CORE_IOPAD(0x34ec, PIN_INPUT_PULLUP    | MUX_MODE14) /* AE9 vin1a_hsync0 gpio3_2 INT ACCEL 2 */
+			DRA7XX_CORE_IOPAD(0x34f0, PIN_INPUT_PULLUP    | MUX_MODE14) /* AF8 vin1a_vsync0 gpio3_3 INT ACCEL 1 */
+			DRA7XX_CORE_IOPAD(0x34f4, PIN_INPUT_PULLUP    | MUX_MODE14) /* AE8 vin1a_d0     gpio3_4 DRDY INT MAG */
+			DRA7XX_CORE_IOPAD(0x36b4, PIN_INPUT_PULLUP    | MUX_MODE10) /* G12 mcasp1_axr0 i2c5_sda */
+			DRA7XX_CORE_IOPAD(0x36b8, PIN_INPUT_PULLUP    | MUX_MODE10) /* F12 mcasp1_axr1 i2c5_scl */
+		>;
+	};
+
+    eqep1_pins: pinmux_eqep1_pins {
+        pinctrl-single,pins = <
+            DRA7XX_CORE_IOPAD(0x350c, PIN_INPUT           | MUX_MODE10) /* AG6 vin1a_d6 eQEP2A_in */
+            DRA7XX_CORE_IOPAD(0x3510, PIN_INPUT           | MUX_MODE10) /* AH4 vin1a_d7 eQEP2B_in */
+        >;
+    };
+
+    uart8_pins: pinmux_uart8_pins {
+        pinctrl-single,pins = <
+            DRA7XX_CORE_IOPAD(0x3734, PIN_INPUT_PULLUP    | MUX_MODE3 ) /* C18 mcasp4_aclkx  uart8_rxd  */
+            DRA7XX_CORE_IOPAD(0x3738, PIN_OUTPUT_PULLDOWN | MUX_MODE3 ) /* A21 mcasp4_fsx    uart8_txd  */
+        >;
+    };
+};
+
+&epwmss1 {
+    status = "okay";
+    ranges = <0x48440000 0x48440000 0x1000>;
+
+    module {
+        reg = <0x48440000 0x1000>;
+        compatible = "uio";
+        symlink = "uio/pwmss1/module";
+    };
+};
+
+&eqep1 {
+    compatible = "uio";
+    status = "okay";
+    pinctrl-names = "default";
+    pinctrl-0 = <&eqep1_pins>;
+    symlink = "uio/pwmss1/qep";
+
+    count_mode = <0>;
+    swap_inputs = <0>;
+    invert_qa = <0>;
+    invert_qb = <0>;
+    invert_qi = <0>;
+    invert_qs = <0>;
+};
+
+&i2c4 {
+    pinctrl-names = "default";
+    pinctrl-0 = <&battery_pins>;
+    status = "okay";
+
+	battery: sbs-battery@b {
+		compatible = "sbs,sbs-battery";
+		reg = <0x0b>;
+		sbs,poll-retry-count = <100>;
+		sbs,i2c-retry-count = <100>;
+	};
+
+	eeprom_ant: eeprom-ant@52 {
+		compatible = "atmel,24c32";
+		reg = <0x52>;
+	};
+};
+
+&i2c5 {
+    pinctrl-names = "default";
+    pinctrl-0 = <&lsm303_pins>;
+    status = "okay";
+
+    accel: accel@19 {
+	    compatible = "st,lsm303agr_accel";
+		st,drdy-int-pin = <1>;
+        reg = <0x19>;
+		interrupt-parent = <&gpio3>;
+		interrupts = <3 IRQ_TYPE_EDGE_RISING>, <2 IRQ_TYPE_EDGE_RISING>;
+    };
+
+    magn: mag@1e {
+	    compatible = "st,lsm303agr_magn";
+		st,drdy-int-pin = <1>;
+        reg = <0x1e>;
+		interrupt-parent = <&gpio3>;
+		interrupts = <4 IRQ_TYPE_EDGE_RISING>;
+    };
+};
+
+&uart8 {
+    status = "okay";
+    pinctrl-names = "default";
+    pinctrl-0 = <&uart8_pins>;
+};
-- 
2.17.1

